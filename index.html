<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>NixOS 手册</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.3.1">
    <link rel="icon" href="/nix-zh/logo.png">
    
    <link rel="preload" href="/nix-zh/assets/css/0.styles.bc7d9574.css" as="style"><link rel="preload" href="/nix-zh/assets/js/app.6243ef40.js" as="script"><link rel="preload" href="/nix-zh/assets/js/2.4808ab9e.js" as="script"><link rel="preload" href="/nix-zh/assets/js/5.882794dd.js" as="script"><link rel="prefetch" href="/nix-zh/assets/js/3.3b36edd3.js"><link rel="prefetch" href="/nix-zh/assets/js/4.8f722a0b.js"><link rel="prefetch" href="/nix-zh/assets/js/6.d0ab2d44.js">
    <link rel="stylesheet" href="/nix-zh/assets/css/0.styles.bc7d9574.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/nix-zh/" class="home-link router-link-exact-active router-link-active"><!----> <span class="site-name">NixOS 手册</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Home</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/nix-zh/#第一章-获取-nixos" class="sidebar-link">第一章 获取 NixOS</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/nix-zh/#第二章-安装-nixos" class="sidebar-link">第二章 安装 NixOS</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/nix-zh/#_2-1-引导启动系统" class="sidebar-link">2.1. 引导启动系统</a></li><li class="sidebar-sub-header"><a href="/nix-zh/#_2-2-分区与格式化" class="sidebar-link">2.2. 分区与格式化</a></li><li class="sidebar-sub-header"><a href="/nix-zh/#_2-3-安装" class="sidebar-link">2.3. 安装</a></li></ul></li></ul></section></li></ul> </aside> <main aria-labelledby="main-title" class="home"><header class="hero"><img src="/nix-zh/logo.png" alt="hero"> <h1 id="main-title">
      NixOS 手册
    </h1> <p class="description">
      Version 19.09
    </p> <!----></header> <!----> <div class="theme-default-content custom content__default"><h1 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h1> <p>本手册描述了如何安装、使用以及拓展 NixOS —— 一个基于纯粹函数式包管理系统 Nix 的 Linux 发行版。</p> <p>倘若遇到问题，请在 <a href="https://discourse.nixos.org/" target="_blank" rel="noopener noreferrer">Discourse<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 或 irc://irc.freenode.net/#nixos 上反馈；倘若遇到漏洞，请在 <a href="https://github.com/NixOS/nixpkgs/issues" target="_blank" rel="noopener noreferrer">NixOS' GitHub issue tracker<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 上反馈。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>带有<code>#</code>前缀的命令需要以 root 身份运行 —— 这意味着你需要以具有 root 权限的用户登陆或将此前缀替换为<code>sudo</code>。</p></div> <h1 id="第一部分-安装"><a href="#第一部分-安装" class="header-anchor">#</a> 第一部分 安装</h1> <p>这一部分描述了第一次使用 NixOS 时应该如何获取、安装并对其进行配置。</p> <h2 id="第一章-获取-nixos"><a href="#第一章-获取-nixos" class="header-anchor">#</a> 第一章 获取 NixOS</h2> <p>NixOS 的镜像文件可以于 <a href="http://nixos.org/nixos/download.html" target="_blank" rel="noopener noreferrer">NixOS 下载页面<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>下载。这里提供了许多安装选项。有光驱和闲置 CD 光盘的话，将镜像文件烧录至光盘上，并通过它启动计算机或许是最容易的方法。大多数人可能会使用 U 盘来引导启动。在第 2.5.1. 节「通过 USB 设备引导启动」描述了如何准备这样的一个 USB 启动盘。在 <a href="https://nixos.wiki/wiki/NixOS_Installation_Guide#Making_the_installation_media" target="_blank" rel="noopener noreferrer">NixOS Wiki<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 上还有更多选项。</p> <p>除了尝试亲自安装 NixOS 外，下面的几种方式也可以获得一个运行的 NixOS 系统：</p> <ul><li>使用开放式虚拟化软件交付格式（OVF），以便在 VirtualBox 上使用。在 <a href="http://nixos.org/nixos/download.html" target="_blank" rel="noopener noreferrer">NixOS 下载页面<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>可用。</li> <li>使用适用于亚马逊弹性计算云服务（EC 2）的亚马逊机器镜像（AMI）。在<a href="https://github.com/NixOS/nixpkgs/blob/master/nixos/modules/virtualisation/ec2-amis.nix" target="_blank" rel="noopener noreferrer">最新亚马逊机器镜像名单<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>可以查看在你的地区的可用项与实例型号。</li> <li>使用基于 NixOS 的云开发工具 —— NixOps。它提供了关于 VirtualBox 和 EC 2 实例的详细规格说明。从 <a href="https://nixos.org/nixops" target="_blank" rel="noopener noreferrer">NixOps 主页<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>获取详细信息。</li></ul> <h2 id="第二章-安装-nixos"><a href="#第二章-安装-nixos" class="header-anchor">#</a> 第二章 安装 NixOS</h2> <h3 id="_2-1-引导启动系统"><a href="#_2-1-引导启动系统" class="header-anchor">#</a> 2.1. 引导启动系统</h3> <p>NixOS 可通过 BIOS 或 UEFI 系统安装。通过 UEFI 与 BIOS 的安装步骤大致是相同的。下面将提及不同的部分。</p> <p>可以通过烧录 CD / USB 设备来制作安装介质。（ 第 2.5.1. 节「通过 USB 设备引导启动」 描述了如何「烧录」USB 启动盘。）</p> <p>安装介质容纳了最基础的 NixOS 安装器。它在引导启动结束时应当检测到你的大部分硬件。</p> <p>在 8 号虚拟控制台为你准备了本手册。按下 <code>Alt</code>+<code>F8</code>或运行<code>nixos-help</code>以查看。</p> <p>你将作为<code>nixos</code>用户自动登陆。此帐户不设口令。因此，<code>sudo</code>也不需要密码。</p> <p>如果你下载了图形化镜像文件，<code>systemctl start display-manager</code>是启动桌面环境的指令。倘若要继续使用终端，<code>loadkeys</code>指令可帮助你切换到你钟爱的键盘布局。（neo 2 也有提供！）</p> <h4 id="_2-1-1-给安装器联网"><a href="#_2-1-1-给安装器联网" class="header-anchor">#</a> 2.1.1. 给安装器联网</h4> <p>太多原料（像是 tarballl 文件和 Nixpkgs 二进制发布频道信息）需要下载，因此引导安装过程需要联网（运行<code>ip a</code>以检测）。所在的网络最好有一个 DHCP 服务器。没有的话，<code>ifconfig</code>可以用于手动配置网络连接。</p> <p>通过图形界面手动配置网络需要先通过运行<code>systemctl stop NetworkManager</code>禁用网络管理器。</p> <p>通过最小安装器手动配置 Wi-Fi 网络需要运行<code>wpa_supplicant -B -i interface -c &lt;(wpa_passphrase 'SSID' 'key')</code>。</p> <p>倘若需要从另外一台设备上通过 SSH 继续安装程序，运行<code>systemctl start sshd</code>以激活 SSH 进程。以「root」 或「nixos」登陆需要设置密码。</p> <h3 id="_2-2-分区与格式化"><a href="#_2-2-分区与格式化" class="header-anchor">#</a> 2.2. 分区与格式化</h3> <p>NixOS 安装器不分区或格式化磁盘，因此，你需要自己完成此工作。</p> <p>NixOS 安装器搭载了多种分区工具，下面的演示例子使用 parted，fdisk、gdisk、cfdisk 与 cgdisk 也供自由选用。</p> <p>推荐的分区方案因计算机的启动方式而异（Legacy Boot 或 UEFI）。</p> <h4 id="_2-2-1-uefi（gpt-分区表）"><a href="#_2-2-1-uefi（gpt-分区表）" class="header-anchor">#</a> 2.2.1 UEFI（GPT 分区表）</h4> <p>对于 UEFI，下面给出一个分区样式。<code>/dev/sda</code>代指被安装的设备：</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>可以安全地忽略 parted 发出的关于需要更新<code>/etc/fstab</code>的消息。</p></div> <ol><li><p>创建一份 GPT 分区表：</p> <div class="language- extra-class"><pre class="language-text"><code># parted /dev/sda -- mklabel gpt
</code></pre></div></li> <li><p>添加根（root）分区，它占据除了磁盘的末端外的空间（也就是交换（swap）分区所在地）。磁盘的前端需要留有 512 Mib 大的空间供给引导分区：</p> <div class="language- extra-class"><pre class="language-text"><code># parted /dev/sda -- mkpart primary 512MiB -8GiB
</code></pre></div></li> <li><p>添加交换分区。按需分配，现在先创建一个 8 GiB 大的：</p> <div class="language- extra-class"><pre class="language-text"><code># parted /dev/sda -- mkpart primary linux-swap -8GiB 100%
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>交换分区大小的规则因 Linux 发行版而异。</p></div></li> <li><p>轮到引导分区。NixOS 默认 ESP（EFI 系统分区）作为<code>/boot</code>分区。先初始化磁盘前端大小为 512 MiB 的部分：</p> <div class="language- extra-class"><pre class="language-text"><code># parted /dev/sda -- mkpart ESP fat32 1MiB 512MiB
# parted /dev/sda -- set 3 boot on
</code></pre></div></li></ol> <p>完成后要做的事，参考<a href="http://cmath.cc/nix-zh/#_2-2-3-%E6%A0%BC%E5%BC%8F%E5%8C%96" target="_blank" rel="noopener noreferrer">第 2.2.3. 节「格式化」<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h4 id="_2-2-2-legacy-boot（mbr-分区表）"><a href="#_2-2-2-legacy-boot（mbr-分区表）" class="header-anchor">#</a> 2.2.2. Legacy Boot（MBR 分区表）</h4> <p>对于 Legacy Boot，下面给出一个分区样式。<code>/dev/sda</code>代指被安装的设备：</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>可以安全地忽略 parted 发出的关于需要更新<code>/etc/fstab</code>的消息。</p></div> <ol><li><p>创建一份 MBR 分区表：</p> <div class="language- extra-class"><pre class="language-text"><code># parted /dev/sda -- mklabel msdos
</code></pre></div></li> <li><p>添加根（root）分区，它占据除了磁盘的末端外的空间（也就是交换（swap）分区所在地）。</p> <div class="language- extra-class"><pre class="language-text"><code># parted /dev/sda -- mkpart primary 1MiB -8GiB
</code></pre></div></li> <li><p>添加交换分区。按需分配，现在先创建一个 8 GiB 大的：</p> <div class="language- extra-class"><pre class="language-text"><code># parted /dev/sda -- mkpart primary linux-swap -8GiB 100%
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>交换分区大小的规则因 Linux 发行版而异。</p></div> <p>完成后要做的事，参考<a href="http://cmath.cc/nix-zh/#_2-2-3-%E6%A0%BC%E5%BC%8F%E5%8C%96" target="_blank" rel="noopener noreferrer">第 2.2.3. 节「格式化」<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></li></ol> <h4 id="_2-2-3-格式化"><a href="#_2-2-3-格式化" class="header-anchor">#</a> 2.2.3. 格式化</h4> <p>可以跟随下面的指令：</p> <ul><li><p>初始化为 Ext 4 分区。建议给文件系统一个有意义的标签（例子中是 nixos），它让文件系统配置独立于设备设置。像这样：</p> <div class="language- extra-class"><pre class="language-text"><code># mkfs.ext4 -L nixos /dev/sda1
</code></pre></div></li> <li><p>创建交换分区：</p> <div class="language- extra-class"><pre class="language-text"><code># mkswap -L swap /dev/sda2
</code></pre></div></li> <li><p>设置 UEFI 系统</p> <p>创建引导分区：</p> <div class="language- extra-class"><pre class="language-text"><code># mkfs.fat -F 32 -n boot /dev/sda3
</code></pre></div></li> <li><p>使用相关指令创建逻辑卷：</p> <p>参考：<a href="https://wiki.archlinux.org/index.php/LVM#Getting_started" target="_blank" rel="noopener noreferrer">LVM<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p>使用 mdadm 可以创建磁盘阵列（RAID）。</p></li></ul> <h3 id="_2-3-安装"><a href="#_2-3-安装" class="header-anchor">#</a> 2.3. 安装</h3> <ol><li><p>挂载将要安装 NixOS 的文件系统（例子是 /mnt）：</p> <div class="language- extra-class"><pre class="language-text"><code># mount /dev/disk/by-label/nixos /mnt
</code></pre></div></li> <li><p>UEFI 设置</p> <p>挂载引导文件系统（例子是 /mnt/boot)：</p> <div class="language- extra-class"><pre class="language-text"><code># mkdir -p /mnt/boot
#mount /dev/disk/by-label/boot /mnt/boot
</code></pre></div></li> <li><p>内存不足的设备可以通过激活交换分区来缓解。安装和构建过程需要与你的配置信息有关的一定量的内存。</p> <div class="language- extra-class"><pre class="language-text"><code># swapon /dev/sda2
</code></pre></div></li> <li><p>具体化的预配置可以通过创建<code>/mnt/etc/nixos/congiguration.nix</code>。NixOS 拥有一个声明式的配置模型：你创作或修改一份关于你所期待的系统配置的文件，将它交给 NixOS 去做并且等待梦想成真。NixOS 配置文件的语法参见第五章「配置语法」。附录 A「配置选项」提供了一系列关于配置文件内容的可选项。在样例 2.4.「NixOS 配置」中给出一个最朴素的例子。</p> <p>命令<code>nixos-generate-config</code>生成一份初始化配置文件：</p> <div class="language- extra-class"><pre class="language-text"><code># nixos-generate-config -- root /mnt
</code></pre></div><p>编辑它使其满足你的需求：</p> <div class="language- extra-class"><pre class="language-text"><code># nano /mnt/etc/nixos/configuration.nix
</code></pre></div><p>倘若使用图形化系统镜像，可能还会有其它可用的编辑器（例如 vim）。</p></li></ol> <p>有网络连接的话，也可以安装其它编辑器，一个实例是通过运行<code>nix-env -f '&lt;nixpkgs&gt;' -iA emacs</code>来安装 Emacs。</p> <p><strong>BIOS 系统</strong></p></div> <!----></main></div><div class="global-ui"></div></div>
    <script src="/nix-zh/assets/js/app.6243ef40.js" defer></script><script src="/nix-zh/assets/js/2.4808ab9e.js" defer></script><script src="/nix-zh/assets/js/5.882794dd.js" defer></script>
  </body>
</html>
